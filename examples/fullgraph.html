<!doctype html>

<html lang="en">
<head>
	<title>Graph viz - toxiclibs.js examples</title>
	<meta name="author" content="Rohit Hiwale">
	<!-- Date: 2011-01-09 -->	
	<script type="text/javascript" src="../build/toxiclibs.js"></script>
	<script type="text/javascript" src="js/processing.js"></script>
	<link href="css/style.css" rel="stylesheet" type="text/css" media="screen">
	
	<script type="text/javascript">
	(function (){
		var i, t;
		window.graph = {};
		window.graph.nodes = {
					'1' : {'particle':undefined, 'id':'1', 'edges': [{'node':'2', 'weight':2}, {'node':'3', 'weight':2}, {'node':'4', 'weight':6}, {'node':'5', 'weight':6}, {'node':'6', 'weight':6}] },
					'2' : {'particle':undefined, 'id':'2', 'edges': []},
					'3' : {'particle':undefined, 'id':'3', 'edges': []},
					'4' : {'particle':undefined, 'id':'4', 'edges': []},
					'5' : {'particle':undefined, 'id':'5', 'edges': []},
					'6' : {'particle':undefined, 'id':'6', 'edges': [{'node':'7', 'weight':2}, {'node':'8', 'weight':2}, {'node':'9', 'weight':6}, {'node':'10', 'weight':6}]},
					'7' : {'particle':undefined, 'id':'7', 'edges': []},
					'8' : {'particle':undefined, 'id':'8', 'edges': []},
					'9' : {'particle':undefined, 'id':'9', 'edges': []},
					'10' : {'particle':undefined, 'id':'10', 'edges': []}
				};
		window.graph.edges = [];
		window.graph.edgelist = [];
		for (node1 in window.graph.nodes){
			t = window.graph.nodes[node1];
			for (i in t['edges']){
				window.graph.edges.push( {'node1':node1, 'node2':t['edges'][i]['node'], 'weight':t['edges'][i]['weight']} );
				window.graph.edgelist.push( [node1, t['edges'][i]['node']] );
			}
		}
		console.log(window.graph.edges);
		console.log(window.graph.edgelist);
		console.log("graph init step done");
	}());
	</script>
	
</head>

<body class="container_12">
	<header class="grid_12">
		<hgroup>
			<h1>Graph viz</h1><h2>w/ <a href="http://processingjs.org">Processing.js</a>
		</hgroup>
	</header>

<script type="text/processing" data-processing-target="myCanvas">
console.log("inside processing code");

var  VerletPhysics2D = toxi.physics2d.VerletPhysics2D,
     VerletParticle2D = toxi.physics2d.VerletParticle2D,
	 RectConstraint = toxi.physics2d.constraints.RectConstraint,
     AttractionBehavior = toxi.physics2d.behaviors.AttractionBehavior,
     BoundaryAttractionBehavior = toxi.physics2d.behaviors.BoundaryAttractionBehavior,
     GravityBehavior = toxi.physics2d.behaviors.GravityBehavior,
     Vec2D = toxi.geom.Vec2D,
     Rect = toxi.geom.Rect,
	 Line2D = toxi.geom.Line2D,
     VerletSpring2D = toxi.physics2d.VerletSpring2D;

import toxi.geom.*;
import toxi.physics2d.*;
import toxi.physics2d.behaviors.*;

int NUM_PARTICLES = 1;

VerletPhysics2D physics;
AttractionBehavior mouseAttractor;

Vec2D mousePos;

VerletSpring2D spm;
VerletParticle2D pm;

void setup() {
  size(680, 382);

  // setup physics with 10% drag
  physics = new VerletPhysics2D();
  window.myphysics = physics;
  physics.setDrag(0.01);
  physics.setWorldBounds(new Rect(0, 0, width, height));
}

VerletParticle2D getorsetnode(String id) {
  if(graph.nodes[id] == undefined){
	graph.nodes[id] = {'particle':undefined, 'id':id};
  }
  if(graph.nodes[id]['particle'] == undefined){
    VerletParticle2D p = addParticle( Vec2D.randomVector().scale(50).addSelf(width/2, height/2) );
    window.graph.nodes[id]["particle"] = p;
  }
  return graph.nodes[id]["particle"];
}

void setedge(String id1, String id2, double w){
	console.log([id1,id2,w]);
	VerletParticle2D p1 = getorsetnode(id1);
	VerletParticle2D p2 = getorsetnode(id2);
	
	VerletSpring2D sp = new VerletSpring2D( p1, p2, 2, 0.001*w);
	physics.addSpring(sp);
}


VerletParticle2D addParticle(Vec2D loc) { 
  VerletParticle2D p = new VerletParticle2D(loc);
  p.setWeight(1000);
  physics.addParticle(p);
  // add a negative attraction force field around the new particle
  physics.addBehavior(new AttractionBehavior(p, 1000, -1000.0, 0));
  return p;
}

void draw() {
  background(255,0,0);
  noStroke();
  fill(255);
  
  //console.log(physics.particles.length);
  physics.update();
  //console.log(physics.particles.length);
  for (int i=0;i<physics.particles.length;i++) {
  	VerletParticle2D p = physics.particles[i];
    ellipse(p.x, p.y, 10, 10);
  }
  
  var j;
  for (j in window.graph.edgelist) {
    var n1 = window.graph.edgelist[j][0];
	var n2 = window.graph.edgelist[j][1];
	VerletParticle2D p1 = window.graph.nodes[n1]['particle'];
	VerletParticle2D p2 = window.graph.nodes[n2]['particle'];
	Line2D(p1, p2);
  }
  
}

void mousePressed() {
  var e = window.graph.edges.pop();
  console.log(e);
  setedge(e['node1'], e['node2'], e['weight']);
}

void mouseDragged() {
  // update mouse attraction focal point
  mousePos.set(mouseX, mouseY);
}

void mouseReleased() {  
}
</script>

<canvas id="myCanvas" width="200" height="200">
	your browser doesnt support canvas
</canvas>

<section class="grid_12" id="details">
<aside id="authors" class="grid_6">
<p>original example by <a href="http://postspectacular.com">Karsten Schmidt</a><br/>
	Toxiclibs ported to js by <a href="http://workofkylephillips.com">Kyle Phillips</a></p>
</aside>
<aside id="usage" class="grid_6">
	 <p><strong>Usage:</strong><br><ul>
	 <li>Click and drag mouse to attract particles</li>
	</ul></p>
</aside>
<article id="description" class="grid_12">

<p>This example demonstrates how to use the behavior handling
(new since toxiclibs-0020 release) and specifically the attraction
behavior to create forces around the current locations of particles
in order to attract (or deflect) other particles nearby.</p>
<p>Behaviors can be added and removed dynamically on both a
global level (for the entire physics simulation) as well as for
individual particles only.</p>
 </article>
</section>
</body>
</html>
